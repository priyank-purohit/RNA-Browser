<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <title>Multi-track RNA-Seq Browser</title>
    <meta name="author" content="Priyank Purohit">
    <link href='http://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="core/tablesorter.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="core/style.css">
    <!-- http://stackoverflow.com/questions/1802936/stop-all-active-ajax-requests-in-jquery -->
    <script type="text/javascript">
    $(function() {
        $.xhrPool = [];
        $.xhrPool.abortAll = function() {
            $(this).each(function(i, jqXHR) { //  cycle through list of recorded connection
                jqXHR.abort(); //  aborts connection
                $.xhrPool.splice(i, 1); //  removes from list by index
            });
        }
        $.ajaxSetup({
            beforeSend: function(jqXHR) {
                $.xhrPool.push(jqXHR);
            }, //  annd connection to list
            complete: function(jqXHR) {
                var i = $.xhrPool.indexOf(jqXHR); //  get index for current connection completed
                if (i > -1) $.xhrPool.splice(i, 1); //  removes from list by index
            }
        });
    })
    </script>
</head>

<body>
    <div class="progress" style="width: 100%; height: 8px; position: fixed; margin-top: 0px; top: 0px;">
        <div id="progress" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="1" aria-valuemin="0" aria-valuemax="113" style="width:1%;"></div>
    </div>
    <div class="container">
        <!-- Title + Help + Cite -->
        <div class="row">
            <div class="col-xs-10 col-sm-10 col-md-10">
                <p style="font-size: 25px; margin: 5px; text-align: center;"><i>A. thaliana</i> Multi-track RNA-Seq Browser</p>
                <p style="font-size: 15px; margin: 5px; text-align: center;">Priyank Purohit, Nicholas Provart. University of Toronto.</p>
            </div>
            <div class="col-xs-2 col-sm-2 col-md-2" style="padding: 15px;">
                <div class="col-xs-4">
                </div>
                <div class="col-xs-4">
                    <button type="button" class="btn btn-default">Cite</button>
                </div>
                <div class="col-xs-4">
                    <button type="button" class="btn btn-info">Help</button>
                </div>
            </div>
        </div>
        <hr style="border: 1px solid gray; margin: 5px; " />
        <!-- Options and Variants selection. -->
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6">
                <div id="variants_div">
                    <!-- Variants will go inside this. -->
                    <div class="radio">
                        <label>
                            <input type="radio" name="radio_group" value="0" checked="checked"><img id="variant_0" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAIBAMAAACYMuIQAAAAFVBMVEX///8AAADcFDz/jACm3KYA fQAAAP/fZdUQAAAASklEQVQ4jWMIJQYEMIAAnIvKwwLAClhxCwSgcAOwyaJoh5kAB2iSeN1ClKpR H2KYOupDevpQcLgDBhd8YAjEYQheDwDBqA+Hvg8BrN6QjkBnEfYAAAAASUVORK5CYII= " class="">
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input type="radio" name="radio_group" value="1"><img id="variant_1" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAIBAMAAACYMuIQAAAAFVBMVEX///8AAADcFDz/jACm3KYA fQAAAP/fZdUQAAAAT0lEQVQ4jWNgDSUCBDAMMsCK6TisHgnAJTHqwwEHoz5ElhMc7oCBxQUPQA0m eMig8rAAjEBFEwhA4QZgk0WPE2LjMATFAw5AiVEfDnkfAgA4ogQVNfQoAAAAAABJRU5ErkJggg== " class="">
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input type="radio" name="radio_group" value="2"><img id="variant_2" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAIBAMAAACYMuIQAAAAFVBMVEX///8AAADcFDz/jACm3KYA fQAAAP/fZdUQAAAAU0lEQVQ4jWNggIJQfCCAYZABVky3sRJy86gPBxcY9SGymwWHO4CHigs2gBoe 8OBB5WEBGIGKJhCAwg3AJoseJ7jiMMQBKsSC5nYHBjQw6sMh60MAoyXme/5P6OAAAAAASUVORK5C YII= " class="">
                        </label>
                    </div>
                    <div class="radio">
                        <label>
                            <input type="radio" name="radio_group" value="3"><img id="variant_3" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAIBAMAAACYMuIQAAAAFVBMVEX///8AAADcFDz/jACm3KYA fQAAAP/fZdUQAAAATUlEQVQ4jWNggIJQKGBABqxQwQCGYQBGfTj0wfD1oeBwB3CfuoCAK944DEWJ 51A8AEUzFoEAFG4ANlkU7ehpC0kyxMWByLgc9eGQ9SEADxGZRA8Xxk8AAAAASUVORK5CYII= " class="">
                        </label>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-6">
                <div class="row">
                    <div class="col-xs-4">
                        <p>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="svg_colour_radio_group" value="abs" checked="checked">Absolute
                                </label>
                                <label style="margin-left: 10px;">
                                    <input type="radio" name="svg_colour_radio_group" value="rel">Relative
                                </label>
                            </div>
                            <i>SVG Colouring Mode</i>
                        </p>
                    </div>
                    <div class="col-xs-1">
                        <input type="button" class="btn" onclick="colour_svgs_now()" value="Go" style="height: 35px;" />
                    </div>
                    <div class="col-xs-1"></div>
                    <div class="col-xs-4">
                        <p>
                            <input type="text" class="form-control" name="Locus" id="locus" value="AT2G24270" style="width: 175px; height: 35px;" /><i>Locus</i>
                        </p>
                    </div>
                    <div class="col-xs-1">
                        <input type="button" class="btn btn-success" onclick="update_all_images()" value="Go" style="height: 35px;" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-4">
                        <p>
                            <input type="text" class="form-control" name="yscale_inp" id="yscale_input" value="0" style="width: 175px; height: 35px;" /><i>RNA-Seq Y-axis Scale</i>
                        </p>
                    </div>
                    <div class="col-xs-1">
                        <input type="button" class="btn" onclick="" value="Go" style="height: 35px;" />
                    </div>
                    <div class="col-xs-1"></div>
                    <div class="col-xs-4">
                        <p>
                            <input type="text" class="form-control" name="rpkm_inp" id="rpkm_input" value="1000" style="width: 175px; height: 35px;" /><i>eFP-RPKM Abs Scale</i>
                        </p>
                    </div>
                    <div class="col-xs-1">
                        <input type="button" class="btn" onclick="colour_svgs_now('abs')" value="Go" style="height: 35px;" />
                    </div>
                </div>
            </div>
        </div>
        <hr style="border: 1px solid gray; margin: 5px; " />
        <!-- RNA-Seq table. -->
        <div class="col-xs-12 table-responsive">
            <table id="thetable" class="table">
                <thead>
                    <tr>
                        <th style="width: 250px;">Title</th>
                        <th style="width: 460px;">RNA-Seq Coverage</th>
                        <th style="width: 100px;">eFP - RPKM</th>
                        <th style="width: 275px;">Description and Details</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <script type="text/javascript">
    var locus = document.getElementById("locus").value; // Which locus does the user want?
    var yscale_input = document.getElementById("yscale_input").value; // What Y-Scale does the user want? Only when the button is pressed the y-scale gets passed to the API otherwise do not include yscale.
    var max_abs_scale = document.getElementById("rpkm_input").value; // What is the max value for the svg colouring in absolute mode?
    var colouring_mode = $('input[type="radio"][name="svg_colour_radio_group"]:checked').val();
    var locus_start = 10326918; // Gets updated when user changes gene
    var locus_end = 10330048; // Gets updated when user changes gene
    var rnaseq_calls = []; // Make a list of records and tissues we need to query....
    // TODO : rename all colours to fpkm_info
    var colours = []; // Keep track of the FPKM related information
    var rnaseq_success = 0; // Make a list of records and tissues we need to query....
    var max_absolute_fpkm = -1;
    var max_log_fpkm = -1;


    function generate_colour(start_color, end_color, percent) {
        // strip the leading # if it's there
        start_color = start_color.replace(/^\s*#|\s*$/g, '');
        end_color = end_color.replace(/^\s*#|\s*$/g, '');

        // convert 3 char codes --> 6, e.g. `E0F` --> `EE00FF`
        if (start_color.length == 3) {
            start_color = start_color.replace(/(.)/g, '$1$1');
        }

        if (end_color.length == 3) {
            end_color = end_color.replace(/(.)/g, '$1$1');
        }

        // get colors
        var start_red = parseInt(start_color.substr(0, 2), 16),
            start_green = parseInt(start_color.substr(2, 2), 16),
            start_blue = parseInt(start_color.substr(4, 2), 16);

        var end_red = parseInt(end_color.substr(0, 2), 16),
            end_green = parseInt(end_color.substr(2, 2), 16),
            end_blue = parseInt(end_color.substr(4, 2), 16);

        // calculate new color
        var diff_red = end_red - start_red;
        var diff_green = end_green - start_green;
        var diff_blue = end_blue - start_blue;

        diff_red = ((diff_red * percent) + start_red).toString(16).split('.')[0];
        diff_green = ((diff_green * percent) + start_green).toString(16).split('.')[0];
        diff_blue = ((diff_blue * percent) + start_blue).toString(16).split('.')[0];

        // ensure 2 digits by color
        if (diff_red.length == 1)
            diff_red = '0' + diff_red

        if (diff_green.length == 1)
            diff_green = '0' + diff_green

        if (diff_blue.length == 1)
            diff_blue = '0' + diff_blue

        return '#' + diff_red + diff_green + diff_blue;
    };



    function colour_part_by_id(id, part, fpkm, mode) {
        max_abs_scale = document.getElementById("rpkm_input").value;
        if (max_abs_scale <= 0 || (!max_abs_scale))
            max_abs_scale = 1000;

        if (document != null) {
            var element = document.getElementById(id);
            if (element != null) {
                var SVG = element.getSVGDocument();
                if (SVG != null) {
                    var part = SVG.getElementById("Shapes");
                    if (part != null) {
                        var paths = part.getElementsByTagName("path");
                        if (paths != null) {
                            if (mode == "abs") {

                                // For absolute FPKM colouring
                                var r = 0,
                                    g = 0,
                                    b = 0;
                                r = 255;
                                g = 255 - parseInt(fpkm / max_abs_scale * 255);
                                b = 0;
                                console.log('abs fpkm = ' + fpkm + ' -> rgb(' + r + ', ' + g + ', ' + b + ')');
                                document.getElementById(id.replace('_svg', '_rpkm')).innerHTML = "";
                                for (i = 0; i < paths.length; i++) {
                                    paths[i].style.fill = 'rgb(' + r + ', ' + g + ', ' + b + ')';
                                }
                            } else if (mode == "rel") {

                                // For relative FPKM colouring
                                var hex = "";
                                if (fpkm > 0) {
                                    hex = generate_colour("FF0000", "FFFF00", Math.abs(fpkm / max_log_fpkm));
                                } else if (fpkm == 0) {
                                    hex = "FFFF00";
                                } else if (fpkm < 0) {
                                    hex = generate_colour("FFFF00", "0000FF", Math.abs(fpkm / max_log_fpkm));
                                }
                                console.log('fpkm = ' + fpkm + ' -> hex = ' + hex);
                                document.getElementById(id.replace('_svg', '_rpkm')).innerHTML = "";
                                for (i = 0; i < paths.length; i++) {
                                    paths[i].style.fill = hex;
                                }
                            }
                        } else {
                            console.log("Paths is null");
                        }
                    } else {
                        console.log("Part is null");
                    }
                } else {
                    console.log("SVG is null");
                }
            } else {
                console.log("Element is null");
            }
        } else {
            console.log("Document is null");
        }
        //$("thetable").trigger("update");
        //$("thetable").trigger("appendCache");


    }

    function colour_svgs_now(mode = $('input[type="radio"][name="svg_colour_radio_group"]:checked').val()) {
        console.log(mode);
        for (var i = 0; i < 113; i++) {
            var fpkm_sum = 0;
            var fpkm_count = 0;
            for (var ii = 0; ii < 113; ii++) {
                if (colours[i][2].indexOf(colours[ii][0].slice(0, -4)) != -1) {
                    // experiment ii is a control for experiment i, save FPKM of exp ii
                    fpkm_count++;
                    fpkm_sum += colours[ii][3];
                }
            }
            var average_controls_fpkm;
            if (fpkm_count == 0)
                average_controls_fpkm = -1;
            else
                average_controls_fpkm = fpkm_sum / fpkm_count;

            //colours[i].push(average_controls_fpkm, Math.log2(colours[i][3] / average_controls_fpkm));
            colours[i].splice(4, 0, average_controls_fpkm);
            colours[i].splice(5, 0, Math.log2(colours[i][3] / average_controls_fpkm));
            //console.log("REL RPKM = Math.log2(" + colours[i][3] + " / " + average_controls_fpkm + " = " + Math.log2(colours[i][3] / average_controls_fpkm));

            if (colours[i][3] >= max_absolute_fpkm)
                max_absolute_fpkm = colours[i][3];
            if (Math.abs(colours[i][5]) >= max_log_fpkm && Math.abs(colours[i][5]) < 1000)
                max_log_fpkm = Math.abs(colours[i][5]);

            //console.log(colours[i]);
            if (mode == "rel") {
                if (!colours[i][5])
                    colours[i][5] = -1;

                colour_part_by_id(colours[i][0], colours[i][1], colours[i][5], mode); // index 5 = relative fpkm
            } else {
                colour_part_by_id(colours[i][0], colours[i][1], colours[i][3], mode); // index 3 = absolute fpkm
            }
        }
        console.log('Max ABS FPKM = ' + max_absolute_fpkm);
        console.log('Max Log FPKM = ' + max_log_fpkm);
        console.log("Colouring function finished. Errors should be above this log entry.");
    }

    /* Re-read the value from the input box*/
    function get_input_values() {
        locus = document.getElementById("locus").value;
        yscale_input = document.getElementById("yscale_input").value;
        colouring_mode = $('input[type="radio"][name="svg_colour_radio_group"]:checked').val();
        // console.log(locus + " - " + yscale_input + " - " + colouring_mode);
    }

    /* When user clicks GO button, this function is called to updated gene structure AND RNA-Seq images*/
    function update_all_images() {
        $.xhrPool.abortAll();
        variants_radio_options();
    }

    /* Updates the radio button <DIV> with new variants */
    function variants_radio_options() {
        get_input_values();
        $.ajax({
            url: 'http://bar.utoronto.ca/~ppurohit/RNA-Browser/cgi-bin/get_gene_structures.cgi?locus=' + locus,
            dataType: 'json',
            success: function(gene_res) {
                // Update locus_start and locus_end
                locus_start = gene_res['locus_start'];
                locus_end = gene_res['locus_end'];
                populate_table();

                // Remove existing variant images.
                var variants_div = document.getElementById("variants_div");
                while (variants_div.firstChild) {
                    variants_div.removeChild(variants_div.firstChild);
                }
                for (var i = 0; i < parseInt(gene_res['variant_count']); i++) {
                    // retrieve the base64 and create the element to insert
                    var append_str = "<div class=\"radio\"><label><input type=\"radio\" value=\"" + i + "\"";
                    if (i == 0) {
                        append_str += "checked=\"checked\"";
                    }
                    append_str += " name=\"radio_group\"><img id=\"variant_" + i + "\" src=\"data:image/png;base64," + gene_res['splice_variants'][i]['gene_structure'] + "\" ></label></div>";
                    // Append the element to the div
                    $("#variants_div").append(append_str);
                }
                var all_gene_structure_imgs = document.getElementsByClassName('gene_structure_img');
                for (var i = 0; i < all_gene_structure_imgs.length; i++) {
                    all_gene_structure_imgs[i].src = "data:image/png;base64," + gene_res['splice_variants'][0]['gene_structure'];
                }
                $('input[type=radio][name=radio_group]').change(function() {
                    gene_structure_radio_on_change();
                });
            }
        });
    }

    /* When radio button changes, update the gene structure throughout the document */
    function gene_structure_radio_on_change() {
        // Find out which variant is currently selected
        var variant_selected = $('input[type="radio"][name="radio_group"]:checked').val();
        // Get the variant's img src
        var base64 = document.getElementById('variant_' + variant_selected).src;
        //console.log(base64);
        // Find all img tags that should be updated (all the <img> with class gene_structure)
        var all_gene_structure_imgs = document.getElementsByClassName('gene_structure_img');
        // Change their src to the newly selected variant's src
        for (var i = 0; i < all_gene_structure_imgs.length; i++) {
            all_gene_structure_imgs[i].src = base64;
        }
    }

    /* Makes AJAX request for each RNA-Seq image based on the rnaseq_calls array that was produced by the populate_table() function */
    function rnaseq_images() {
        rnaseq_success = 0;
        get_input_values();
        // GET RNA-Seq data for this row
        // Need: tissue, experimentno, locus, start, end
        if (rnaseq_calls.length == 113) {
            for (var i = 0; i < 113; i++) {
                $.ajax({
                    url: 'http://ec2-52-70-232-122.compute-1.amazonaws.com/~ppurohit/RNA-Browser/cgi-bin/webservice.cgi?tissue=' + rnaseq_calls[i][0] + '&record=' + rnaseq_calls[i][1] + '&locus=' + locus + '&variant=1&start=' + locus_start + '&end=' + locus_end,
                    dataType: 'json',
                    success: function(response_rnaseq) {
                        // find the element and update picture
                        document.getElementById(response_rnaseq['record'] + '_rpkm').innerHTML = response_rnaseq['absolute-fpkm'];
                        document.getElementById(response_rnaseq['record'] + '_rnaseq_img').src = 'data:image/png;base64,' + response_rnaseq['rnaseqbase64'];

                        // Colour SVG (Absolute RPKM)
                        // For absolute FPKM colouring
                        colour_part_by_id(response_rnaseq['record'] + '_svg', 'Shapes', response_rnaseq['absolute-fpkm'], 'abs');
                        /*var svg_appended_just_now = document.getElementById(response_rnaseq['record'] + '_svg').getSVGDocument().getElementById('Shapes').getElementsByTagName('path');
                        var r = 0,
                            g = 0,
                            b = 0;
                        r = 255;
                        g = parseInt(response_rnaseq['absolute-fpkm'] / 1000 * 255);
                        b = 0;
                        console.log('absolute-fpkm = ' + response_rnaseq['absolute-fpkm'] + ' -> rgb(' + r + ', ' + g + ', ' + b + ')');
                        for (i = 0; i < svg_appended_just_now.length; i++) {
                            svg_appended_just_now[i].style.fill = 'rgb(' + r + ', ' + g + ', ' + b + ')';
                        }*/

                        //var percent = parseInt(document.getElementById('progress').style.width);
                        rnaseq_success++;
                        var percent = rnaseq_success / 113 * 100;
                        $('div#progress').width(percent + '%');

                        // find and push abs-fpkm ..
                        for (var ii = 0; ii < 113; ii++) {
                            if (colours[ii][0] == response_rnaseq['record'] + '_svg') {
                                //colours[ii].push(response_rnaseq['absolute-fpkm']);
                                colours[ii].splice(3, 0, response_rnaseq['absolute-fpkm']);
                                console.log("Found record = " + response_rnaseq['record'] + " and pushed its RPKM value of " + response_rnaseq['absolute-fpkm']);
                                console.log(colours[ii]);
                            }
                        }
                        //$("thetable").trigger("update");
                        //$("thetable").trigger("appendCache");

                    }
                });
            }
        }
    }

    /* On page load, gets the BAM locator XML file to create and populate the table. Also keeps track of all RNA-Seq calls it will have to make. */
    function populate_table() {
        // Clear up the table + RNA-Seq Calls
        $("#thetable").empty();
        rnaseq_calls = [];
        colours = [];

        // Insert table headers
        $("#thetable").append('<thead><tr>' + '<th style="width: 250px;">Title</th>' + '<th style="width: 460px;">RNA-Seq Coverage</th>' + '<th style="width:  100px;">eFP - RPKM</th>' + '<th style="width: 275px;">Description and Details</th>' + '</tr></thead>' + '<tbody></tbody>');

        $.ajax({
            url: 'data/bamdata_amazon_links.xml',
            dataType: 'xml',
            success: function(xml_res) {
                var $title = $(xml_res).find("bam_file");
                $title.each(function() { // Iterate over each subtag inside the <file> tag.
                    // Extract information
                    var title = $(this).attr('title');
                    var description = $(this).attr('desc');
                    var svg = $(this).attr('svgname');
                    var experimentno = $(this).attr('record_number');
                    var url = $(this).attr('publication_url');
                    var publicationid = $(this).attr('publication_link');
                    var numberofreads = $(this).attr('total_reads_mapped');
                    var controls = $(this).find("controls")[0].innerHTML.replace(/<bam_exp>/g, "").replace(/<\/bam_exp>/g, ",").replace(/\n/g, " ").replace(/ /g, "").split(",");
                    var links = "";
                    for (var i = controls.length; i--;) {
                        if (controls[i] != "MEDIAN") {
                            links += '<a href="http://www.ncbi.nlm.nih.gov/Traces/sra/?run=' + controls[i] + '" target="blank">' + controls[i] + '</a> ';
                        } else {
                            links += controls[i];
                        }
                    }
                    var name = $(this).attr('bam_link').split("/");
                    var tissue = $(this).attr('bam_link').split("/")[8];
                    var subunitname = $(this).attr('svg_subunit'); // supposed to be the one that gets coloured

                    // Keep track of what experiments we want to query:
                    // Need: tissue, experimentno in rnaseq_calls ... (also need start, end, and locus)
                    rnaseq_calls.push([tissue, experimentno]);

                    // Construct a table row <tr> element
                    var append_str = '<tr>';
                    // Append title
                    append_str += '<td style="width: 250px;">' + title + '</td>\n';
                    // Append RNA-Seq and Gene Structure images (2 imgs)
                    // src="data:image/png;base64,' + response_rnaseq['rnaseqbase64'] + '" 
                    append_str += '<td style="width: 460px;">' + '<img id="' + experimentno + '_rnaseq_img" width="450px" height="50px" class="rnaseq_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAA3CAIAAAAQUt0MAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwQAADsEBuJFr7QAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC45bDN+TgAAA4VJREFUeF7t2sFLqmkUgPH50yMKXIhEIoSLiCKIFhFFECG2CImIEJFoERIhEiESIRER4TzX48gw98Ywc0zi8vwW8fr6fZ939XBevX+MJEkJZlSSUsyoJKWYUUlKMaOSlGJGJSnFjEpSihmVpBQzKkkpZlSSUsyoJKWYUUlKMaOSlGJGJSnFjEpSihmVpBQzKkkpZlSSUsyoJKWYUUlKMaOSlGJGJSnFjOqben9/v7u763Q6k9fSd2VGNWPD4XBra6tcLne73cnW//Lx8XF2drayshIvWSPW0rdiRjV7p6enGxsbkxcJTKPTjN6MxVr6VsyoZu+zjHJOZ0Tt9XpMmpOt0ej19ZVcPj4+Tl6PMdKy2Wq1IqPxst/vs+Yva+6KTZ45vuOHwWDATnh4eJjsSl/MjGr2fplRulapVCjj0dERp/7Y3N/f39vbazabpVKp3W7H5vHx8c7Ozu3tLZdFRonm9vY2F7OmlYVCgYecnJxsbm5Wq9XxTSMesr6+zl1s8uksYl/6amZUs/fLjNK7q6srFoyixWIxxs/r6+sYJ+v1+sHBAYtOp7O0tBTjKuvpoZ5nRkbBZnxP+vT0tLCw8Pz8zHptbS1CTEBXV1d/XCfNhRnV7P2cUVq5uLg4PWgzWjYajVgTQWLKCBmVZJ+hMt7ibP5ZRnkr1mSUmLJgdI1n3tzc7O7ujt+U5sGMavb+kdGLiwtO5fRu2j7O7Ofn5yw40RNHpk4O8lFJ7mWuHF/13zLa6/XYr9VqnPf9YlTzZEY1e3/PaL/fjzUH7ZgWObCXSqX7+3vmUEbUONQzP0YlW60Wm8PhkDWp/SyjDLCxnmaUJwwGg9gMxDRiPf2Vn4dYWM2cGdWMUUC6WSwWqR4qlUpkNEbLmBaZT9mhp+VymcN4/F7Eu3SQTWbVQqFweHjYbrepJMXkmdVqlRBzAVPn8vIy1/CEy8tLLojvSdnhQ3kIn8i9b29vzWYzKhz/EhZczCYLaYbMqObq5eVlsvrLzzuITZIak+a/YqQlx91ul+v5S7j9v/qaGzOq3wFH9VKpFL/vg9nTqVNzY0b1OyCgtVqNc329XmfRaDSmSZW+mhmVpBQzKkkpZlSSUsyoJKWYUUlKMaOSlGJGJSnFjEpSihmVpBQzKkkpZlSSUsyoJKWYUUlKMaOSlGJGJSnFjEpSihmVpBQzKkkpZlSSUsyoJCWMRn8CzQo9MHuLdY4AAAAASUVORK5CYII=" /><br/>' + '<img id="' + experimentno + '_gene_structure_img" width="450px" height="8px" class="gene_structure_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAIBAMAAACYMuIQAAAAFVBMVEX///8AAADcFDz/jACm3KYA fQAAAP/fZdUQAAAASklEQVQ4jWMIJQYEMIAAnIvKwwLAClhxCwSgcAOwyaJoh5kAB2iSeN1ClKpR H2KYOupDevpQcLgDBhd8YAjEYQheDwDBqA+Hvg8BrN6QjkBnEfYAAAAASUVORK5CYII= " />' + '</td>\n';
                    // Append the approparite SVG with correct sorting number in front of it (number stays hidden)
                    append_str += '<td style="width:  75px;">' + '<span id="' + experimentno + '_rpkm' + '" style="display: block; font-size: 10px;">' + numberofreads + '</span>' + '<object id="' + experimentno + '_svg' + '" data="SVGs/' + svg.substring(4) + '" width="75" height="75" type="image/svg+xml"></object>' + '</td>\n';
                    // Append the details  
                    append_str += '<td style="width: 200px;">' + description + '<br/>' + '<a href="' + url + '" target="blank">' + 'NCBI SRA' + '</a>; <a href="' + publicationid + '" target="blank">PubLink</a>' + '<br/><a href="javascript:(function(){$(\'#' + url.substring(44) + '\').toggle();})()">More Details</a><div id="' + url.substring(44) + '" style="display:none">Total reads = ' + numberofreads + '.<br/>Controls: ' + links + '</div></td>\n';
                    append_str += '</tr>';

                    // Append the <tr> to the table
                    $("#thetable").append(append_str);


                    colours.push([experimentno + '_svg', 'Shapes', controls]);

                    if (rnaseq_calls.length == 113) {

                        gene_structure_radio_on_change();
                        rnaseq_images();
                    }
                });
                //$('#thetable').tablesorter();
            }
        });
    }

    // Leave this document ready here, even if there is nothing in it... just leave it pls.
    // A $( document ).ready() block.
    $(document).ready(function() {
        // For the first time
        $('input[type=radio][name=radio_group]').change(function() {
            gene_structure_radio_on_change();
        });
    });
    populate_table();
    </script>
</body>

</html>
